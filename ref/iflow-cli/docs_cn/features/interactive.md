---
sidebar_position: 1
hide_title: true
---

# 交互模式

> **功能概述**：iFlow CLI 提供多种灵活的交互方式，支持文本输入、图片处理、文件引用和智能多模态处理。
> 
> **学习时间**：10-15分钟
> 
> **前置要求**：已安装并配置iFlow CLI，了解基本命令行操作

## 什么是交互模式

交互模式是iFlow CLI 的核心功能，它允许用户通过多种方式与AI进行自然的对话和协作。系统支持文本、图片、文件引用等多种输入形式，并提供智能的多模态处理能力，让任何模型都能"理解"图片内容。

## 核心特点

| 特点 | 说明 | 平台支持 |
|------|------|----------|
| 多种输入方式 | 文本、图片、文件引用等多种输入形式 | 全平台 |
| 智能多模态处理 | 让任何模型都能"理解"图片内容 | 全平台 |
| 自动内容检测 | 智能识别并处理不同类型的输入内容 | 全平台 |
| 大文本优化 | 自动处理长文本，优化界面显示 | 全平台 |
| 实时响应 | 实时处理用户输入，无需等待 | 全平台 |

## 工作原理

### 输入处理流程

```
用户输入 → 内容类型检测 → 预处理 → 模型适配 → AI响应
    ↓
[文本/图片/文件] → [自动识别] → [格式优化] → [多模态处理] → [生成回复]
```

### 智能适配机制

- **文本输入**：直接传递给AI模型处理
- **图片输入**：自动检测模型能力，必要时生成图片描述
- **文件引用**：读取文件内容并整合到对话上下文
- **混合输入**：智能组合不同类型的输入内容

## 详细功能说明

### 文本输入

#### 单行文本
直接在命令行界面输入您的问题或指令：
```bash
> 帮我优化这个React组件的性能
```

#### 多行文本输入
支持多种方式输入多行文本：

| 方法 | 操作 | 说明 |
|------|------|------|
| 反斜杠换行 | `\` + `Enter` | 快速创建多行输入 |
| Shift + Enter | `Shift` + `Enter` | 终端配置后可用 |

示例：
```bash
> 请帮我实现一个用户管理系统，包括：\
  1. 用户注册和登录功能
  2. 用户信息的增删改查
  3. 权限管理
  4. 数据持久化
```

### 图片处理

#### 支持的图片格式

| 格式 | 扩展名 | 说明 |
|------|--------|------|
| PNG | .png | 高质量图片，支持透明度 |
| JPEG | .jpg, .jpeg | 压缩图片格式 |
| GIF | .gif | 支持动图 |
| WebP | .webp | 现代图片格式 |
| BMP | .bmp | 位图格式 |

#### 图片输入方式

**截图粘贴**

| 平台 | 截图快捷键 | 粘贴快捷键 |
|------|------------|------------|
| Windows | `Win + Shift + S` | `Ctrl + V` |
| macOS | `Cmd + Shift + 4` | `Cmd + V` |
| Linux | `PrtScn` 或其他 | `Ctrl + V` |

操作步骤：
1. 使用系统截图工具截取需要分析的屏幕区域
2. 在iFlow CLI 中按快捷键粘贴
3. 系统自动生成图片占位符并处理

**文件粘贴**
- 在文件管理器中复制图片文件
- 在CLI中使用粘贴快捷键

粘贴后显示效果：
```bash
> [Pasted image #1] 这个界面有什么问题？
```

需要注意的是，原生终端、iTerm 终端以及 IDE 内置终端会强制过滤掉图片的粘贴事件，导致使用平台的原生粘贴快捷键时无法粘贴图片（比如 macOS 使用 `Cmd + V` 粘贴图片无效），此时可以使用 `Ctrl + V` 或 `Shift + Ctrl + V` 绕过这个过滤来粘贴图片。

#### 图片处理示例

```bash
> [Pasted image #1] 请分析这个用户界面的设计问题
> [Pasted image #2] 这两个界面布局哪个更好？
> 帮我根据 [Pasted image #1] 这个设计稿写出对应的CSS代码
```

### 大文本处理

#### 自动检测规则

| 检测项 | 阈值 | 处理方式 |
|--------|------|----------|
| 长文本粘贴 | >800字符 | 生成文本占位符 |
| 长内容显示 | >5000字符 | 截断显示优化 |
| 占位符格式 | - | `[Pasted text #X +Y lines]` |

#### 界面优化特性

- **视觉简洁**：避免长文本在终端中造成滚屏混乱
- **内容完整**：虽然显示被优化，但模型仍能获得完整的原始文本
- **智能截断**：显示前2000个字符和最后2000个字符，中间内容折叠
- **标识清晰**：占位符明确标识文本块的行数，便于识别内容规模

#### 使用示例

```bash
> 请帮我重构这段代码：[Pasted text #1 +45 lines]
> 分析这个日志文件中的错误：[Pasted text #2 +120 lines]
```

#### 操作流程

1. 复制大量文本内容到剪贴板
2. 在CLI中按 `Ctrl/Cmd + V`
3. 系统自动生成占位符并保存原始内容
4. 继续输入您的问题或指令

### 文件引用

#### 引用方式

| 类型 | 语法 | 示例 |
|------|------|------|
| 单个文件 | `@文件路径` | `@src/App.tsx` |
| 目录引用 | `@目录路径` | `@src/components` |
| 多文件 | 空格分隔 | `@file1.ts @file2.ts` |

#### 使用示例

**单文件引用**
```bash
> 帮我优化 @src/components/UserProfile.tsx 这个组件
> 请解释 @docs/api.md 中的API设计思路
```

**目录引用**
```bash
> 分析 @src/utils 目录下的工具函数
> 重构 @src/components 目录的组件结构
```

**多文件引用**
```bash
> 比较 @src/old-component.tsx 和 @src/new-component.tsx 的区别
> 根据 @package.json 和 @tsconfig.json 配置优化项目结构
```

### 智能多模态处理

#### 核心特性

iFlow CLI 的独特之处在于其智能多模态处理机制，让任何模型都能"看懂"图片。

#### 工作原理

**自动图片描述生成**

| 步骤 | 操作 | 说明 |
|------|------|------|
| 1 | 模型能力检测 | 检测主模型是否支持多模态 |
| 2 | 多模态调用 | 不支持时自动调用多模态模型 |
| 3 | 描述生成 | 生成详细的图片描述信息 |
| 4 | 内容整合 | 将描述传递给主模型处理 |

**描述内容包括**
- 整体布局和构图
- 主要对象和位置关系
- 颜色信息和视觉特征
- 文字内容（完整转录）
- 背景环境和细节特征

#### 注册配置

**心流AI方式登录**

| 项目 | 说明 |
|------|------|
| 推荐选择 | 系统提供的模型都经过优化 |
| 自动处理 | 自动使用 `qwen-vl-max` 生成图片描述 |
| 配置需求 | 无需手动配置，完全自动化 |

**OpenAI兼容方式登录**

| 配置项 | 说明 | 必需 |
|---------|------|------|
| 主模型名称 | 指定主要使用的模型 | 是 |
| 多模态模型 | 用于图片描述生成 | 否 |
| 跳过配置 | 直接发送给主模型 | 否 |

#### 性能说明

| 项目 | 说明                                   |
|------|--------------------------------------|
| 优势 | 让所有模型都具备图片理解能力                       |
| 注意 | 非多模态模型处理图片速度稍慢（因为需要先生成图片描述再输入给主模型理解） |
| 建议 | 频繁多模态需求建议直接使用多模态模型                   |

### 键盘快捷键

#### 基础快捷键

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 取消操作 | `Ctrl/Cmd + C` | 取消当前输入或生成 |
| 退出程序 | `Ctrl/Cmd + D` | 退出CLI会话 |
| 清屏 | `Ctrl/Cmd + L` | 清空终端屏幕 |
| 历史命令 | `↑/↓` | 浏览命令历史 |

#### 输入相关

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 粘贴内容 | `Ctrl/Cmd + V` | 自动检测图片、文本 |
| 多行输入 | `\` + `Enter` | 反斜杠换行 |
| 多行输入 | `Shift/Option + Enter` | 根据终端配置 |

#### Vim模式

使用 `/vim` 命令启用后支持：

| 操作 | 按键 | 说明 |
|------|------|------|
| 光标移动 | `h/j/k/l` | 左/下/上/右 |
| 删除行 | `dd` | 删除当前行 |
| 删除字符 | `x` | 删除当前字符 |

## 使用示例

### 常见场景

#### UI设计分析
```bash
> [Pasted image #1] 请分析这个登录页面的用户体验问题
```

#### 代码调试
```bash
> [Pasted image #1] 这个错误截图显示的问题如何解决？
```

#### 文件分析
```bash
> 请分析 @src/components/Header.tsx 的性能问题并提供优化建议
```

#### 复杂问题
```bash
> 请帮我实现一个用户管理系统，包括：\
  1. 用户注册和登录功能
  2. 用户信息的增删改查
  3. 权限管理
  4. 数据持久化
```

### 最佳实践

#### 图片使用技巧
- **UI设计分析**：截图界面后询问设计改进建议
- **代码调试**：粘贴错误截图快速定位问题
- **文档理解**：上传图表、流程图等复杂图像内容
- **比较分析**：同时粘贴多张图片进行对比

#### 文本处理优化
- **大文件处理**：利用自动占位符功能处理长代码或日志
- **结构化询问**：使用多行输入组织复杂问题
- **上下文引用**：结合 `@` 文件引用提供完整上下文

#### 模型选择建议
- **纯文本任务**：使用文本模型即可，速度更快
- **偶尔图片需求**：继续使用文本模型，自动处理图片
- **频繁多模态**：选择多模态模型以获得最佳体验

## 故障排除

### 常见问题及解决方案

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 图片粘贴失败 | 格式不支持或剪贴板无数据 | 检查图片格式，重新截图或复制 |
| 文件引用无效 | 路径错误或文件不存在 | 确认文件路径正确且文件可访问 |
| 多行输入异常 | 终端配置问题 | 尝试不同的换行快捷键组合 |
| 多模态处理错误 | 模型配置不正确 | 检查模型支持情况和配置 |
| 大文本上传失败 | 内容过大或网络问题 | 分段上传或检查网络连接 |

### 诊断步骤

1. **权限检查**
   - 确认系统允许CLI访问剪贴板
   - 检查文件读取权限

2. **网络连接**
   - 确认网络连接正常（多模态处理需要API调用）
   - 检查防火墙设置

3. **配置验证**
   - 查看错误提示信息
   - 根据提示调整操作
   - 重启CLI确保配置生效

### 平台兼容性

| 平台 | 支持情况 | 注意事项 |
|------|----------|----------|
| Windows | 完全支持 | 注意路径分隔符 |
| macOS | 完全支持 | 系统权限可能需要授权 |
| Linux | 完全支持 | 依赖系统剪贴板工具 |